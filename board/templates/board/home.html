<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your boards</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-slate-100 text-slate-900">
  {% csrf_token %}
  <header class="sticky top-0 z-40 border-b bg-white/90 backdrop-blur">
    <div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-3">
      <div class="flex items-center gap-3">
        <a href="{% url 'board:home' %}"><div class="h-8 w-8 rounded-lg bg-cyan-500 font-serif text-white p-2">Lini</div></a>
      </div>

      <div class="flex items-center gap-2">
        <a class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50" href="{% url 'board:logout' %}">Logout</a>
      </div>
    </div>
  </header>
  <main class="mx-auto max-w-4xl px-4 py-6 space-y-6">
    <div class="grid gap-4 md:grid-cols-2">
      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
        <div class="text-sm font-semibold">Create board</div>
        <div class="mt-3 flex gap-2">
          <input id="boardName" class="flex-1 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:border-slate-400" placeholder="Board name" />
          <button id="createBoardBtn" class="rounded-lg bg-slate-900 px-3 py-2 text-sm font-medium text-white hover:bg-slate-800">Create</button>
        </div>
      </div>

      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
        <div class="text-sm font-semibold">Join board</div>
        <div class="mt-3 flex gap-2">
          <input id="joinCode" class="flex-1 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:border-slate-400" placeholder="Join code" />
          <button id="joinBoardBtn" class="rounded-lg bg-slate-900 px-3 py-2 text-sm font-medium text-white hover:bg-slate-800">Join</button>
        </div>
      </div>
    </div>

    <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
      <div class="text-sm font-semibold">Your boards</div>
      <div class="mt-3 space-y-2">
        {% for m in memberships %}
          <a class="block rounded-xl border border-slate-200 bg-white px-3 py-3 hover:bg-slate-50"
             href="{% url 'board:board_view' m.board.id %}">
            <div class="flex items-center justify-between">
              <div class="font-medium">{{ m.board.name }}</div>
              <div class="text-xs text-slate-600">{{ m.role }}</div>
            </div>
            <div class="mt-1 text-xs text-slate-500">Code: {{ m.board.join_code }}</div>
          </a>
        {% empty %}
          <div class="text-sm text-slate-600">No boards yet.</div>
        {% endfor %}
      </div>
    </div>
  </main>

  <script>
    function getCsrfToken() {
      const el = document.querySelector("input[name=csrfmiddlewaretoken]");
      return el ? el.value : "";
    }

    async function postJson(url, data) {
      const res = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": getCsrfToken(),
        },
        body: JSON.stringify(data || {}),
      });
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    }

    const createBoardBtn = document.getElementById("createBoardBtn");
    const joinBoardBtn = document.getElementById("joinBoardBtn");

    createBoardBtn.addEventListener("click", async () => {
      const name = (document.getElementById("boardName").value || "").trim();
      if (!name) return;
      const r = await postJson("{% url 'board:board_create' %}", { name });
      location.href = "/boards/" + r.board_id + "/";
    });

    joinBoardBtn.addEventListener("click", async () => {
      const join_code = (document.getElementById("joinCode").value || "").trim();
      if (!join_code) return;
      const r = await postJson("{% url 'board:board_join' %}", { join_code });
      location.href = "/boards/" + r.board_id + "/";
    });
  </script>
</body>
</html>
